name: LIBXSMM Arm Graviton 3

on:
  workflow_dispatch:
  push:

env:
  LIBXSMM_VERBOSE: 4
  SYM: 2

jobs:
  GEMM:
    runs-on: [ self-hosted, graviton ]
    steps:
      - uses: actions/checkout@v4
      - name: GEMM
        run: "scripts/tool_test.sh samples/xgemm/kernel_test.sh"

  BCSC_SPMM:
    runs-on: [ self-hosted, graviton ]
    steps:
      - uses: actions/checkout@v4
      - name: BCSC_SPMM
        run: "scripts/tool_test.sh samples/spmm/kernel_test.sh"

  ELTWISE:
    runs-on: [ self-hosted, graviton ]
    steps:
      - uses: actions/checkout@v4
      - name: ELTWISE
        run: "scripts/tool_test.sh samples/eltwise/run_test.sh"

  EQUATION:
    runs-on: [ self-hosted, graviton ]
    steps:
      - uses: actions/checkout@v4
      - name: EQUATION
        run: "scripts/tool_test.sh samples/equation/run_test.sh"

  FSSPMDM:
    runs-on: [ self-hosted, graviton ]
    steps:
      - uses: actions/checkout@v4
      - name: FSSPMDM
        run: |-
          ENVS="LIBXSMM_FSSPMDM_HINT=1 LIBXSMM_FSSPMDM_HINT=2 LIBXSMM_FSSPMDM_HINT=3" \
          TEST_N=48 scripts/tool_test.sh samples/pyfr/test.sh

  Test_4:
    runs-on: [ self-hosted, graviton ]
    steps:
      - uses: actions/checkout@v4
      - name: TEST_4
        run: "scripts/tool_test.sh 4"

  Test_6:
    runs-on: [ self-hosted, graviton ]
    steps:
      - uses: actions/checkout@v4
      - name: TEST_6
        run: "scripts/tool_test.sh 6"

  Test_11:
    runs-on: [ self-hosted, graviton ]
    steps:
      - uses: actions/checkout@v4
      - name: TEST_11
        run: "scripts/tool_test.sh 11"

  Fortran:
    runs-on: [ self-hosted, graviton ]
    steps:
      - uses: actions/checkout@v4
      - name: FORTRAN
        run: "scripts/tool_test.sh 5"
